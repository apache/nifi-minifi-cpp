From cf90b37da9432cf957f4f2e3ce837d6c73647802 Mon Sep 17 00:00:00 2001
From: Adam Hunyadi <hunyadi.dev@gmail.com>
Date: Fri, 4 Dec 2020 11:26:12 +0100
Subject: [PATCH] Fix checks for available compiler flags

---
 cmake/AddCCompilerFlag.cmake   | 5 ++---
 cmake/AddCXXCompilerFlag.cmake | 5 ++---
 2 files changed, 4 insertions(+), 6 deletions(-)

diff --git a/cmake/AddCCompilerFlag.cmake b/cmake/AddCCompilerFlag.cmake
index f5550fa7..5eaf8907 100644
--- a/cmake/AddCCompilerFlag.cmake
+++ b/cmake/AddCCompilerFlag.cmake
@@ -24,9 +24,8 @@ function(add_c_compiler_flag FLAG)
   string(REPLACE "+" "X" SANITIZED_FLAG ${SANITIZED_FLAG})
   string(REGEX REPLACE "[^A-Za-z_0-9]" "_" SANITIZED_FLAG ${SANITIZED_FLAG})
   string(REGEX REPLACE "_+" "_" SANITIZED_FLAG ${SANITIZED_FLAG})
-  set(CMAKE_REQUIRED_FLAGS "${FLAG}")
-  check_c_compiler_flag("" ${SANITIZED_FLAG})
-  if(${SANITIZED_FLAG})
+  check_c_compiler_flag(${SANITIZED_FLAG} NO_DIAGNOSTICS_PRODUCED)
+  if(${NO_DIAGNOSTICS_PRODUCED})
     set(VARIANT ${ARGV1})
     if(ARGV1)
       string(REGEX REPLACE "[^A-Za-z_0-9]" "_" VARIANT "${VARIANT}")
diff --git a/cmake/AddCXXCompilerFlag.cmake b/cmake/AddCXXCompilerFlag.cmake
index 5e58c6de..6607c627 100644
--- a/cmake/AddCXXCompilerFlag.cmake
+++ b/cmake/AddCXXCompilerFlag.cmake
@@ -24,9 +24,8 @@ function(add_cxx_compiler_flag FLAG)
   string(REPLACE "+" "X" SANITIZED_FLAG ${SANITIZED_FLAG})
   string(REGEX REPLACE "[^A-Za-z_0-9]" "_" SANITIZED_FLAG ${SANITIZED_FLAG})
   string(REGEX REPLACE "_+" "_" SANITIZED_FLAG ${SANITIZED_FLAG})
-  set(CMAKE_REQUIRED_FLAGS "${FLAG}")
-  check_cxx_compiler_flag("" ${SANITIZED_FLAG})
-  if(${SANITIZED_FLAG})
+  check_cxx_compiler_flag(${SANITIZED_FLAG} NO_DIAGNOSTICS_PRODUCED)
+  if(${NO_DIAGNOSTICS_PRODUCED})
     set(VARIANT ${ARGV1})
     if(ARGV1)
       string(REGEX REPLACE "[^A-Za-z_0-9]" "_" VARIANT "${VARIANT}")
-- 
2.29.2

