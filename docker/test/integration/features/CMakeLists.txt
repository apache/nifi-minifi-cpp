# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

set(ENABLED_BEHAVE_TESTS "")

if (ENABLE_LIBRDKAFKA)
    list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/kafka.feature")
endif()

list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/attributes_to_json.feature")
list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/core_functionality.feature")
list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/defragtextflowfiles.feature")
list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/file_system_operations.feature")
list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/hashcontent.feature")
list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/replace_text.feature")
list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/routetext.feature")
list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/s2s.feature")
list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/syslog_listener.feature")
list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/network_listener.feature")
list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/minifi_c2_server.feature")

if (ENABLE_AZURE)
    list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/azure_storage.feature")
endif()

if (ENABLE_GCP)
    list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/google_cloud_storage.feature")
endif()

if (NOT DISABLE_CIVET)
    list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/http.feature")
    list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/https.feature")
endif()

if (ENABLE_KUBERNETES)
    list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/kubernetes_logging.feature")
    list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/kubernetes_metrics.feature")
endif()

if (ENABLE_MQTT)
    list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/mqtt.feature")
endif()

if (ENABLE_OPC)
    list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/opcua.feature")
endif()

if (ENABLE_PYTHON_SCRIPTING)
    list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/python.feature")
    list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/python_script.feature")
endif()

if (ENABLE_LUA_SCRIPTING)
    list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/lua_script.feature")
endif()

if (ENABLE_AWS)
    list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/s3.feature")
endif()

if (ENABLE_SPLUNK)
    list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/splunk.feature")
endif()

if (ENABLE_SQL)
    list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/sql.feature")
endif()

if (ENABLE_ELASTICSEARCH AND NOT CI_BUILD) # Elasticsearch/Opensearch containers require more RAM than what the CI environment has
    list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/elasticsearch.feature")
    list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/opensearch.feature")
endif()

if (ENABLE_PROMETHEUS)
    list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/prometheus.feature")
endif()

if (NOT DISABLE_CURL AND NOT DISABLE_CONTROLLER)
    list(APPEND ENABLED_BEHAVE_TESTS "${CMAKE_CURRENT_SOURCE_DIR}/minifi_controller.feature")
endif()

file(GLOB FEATURE_FILES  "*.feature")

list(LENGTH ENABLED_BEHAVE_TESTS ENABLED_BEHAVE_TESTS_LENGTH)

math(EXPR ENABLED_BEHAVE_TESTS_QUADRANT_LENGTH ${ENABLED_BEHAVE_TESTS_LENGTH}/4)

math(EXPR ENABLED_BEHAVE_TESTS_SECOND_QUADRANT_START ${ENABLED_BEHAVE_TESTS_QUADRANT_LENGTH})
math(EXPR ENABLED_BEHAVE_TESTS_THIRD_QUADRANT_START ${ENABLED_BEHAVE_TESTS_QUADRANT_LENGTH}*2)
math(EXPR ENABLED_BEHAVE_TESTS_LAST_QUADRANT_START ${ENABLED_BEHAVE_TESTS_QUADRANT_LENGTH}*3)


list(SUBLIST ENABLED_BEHAVE_TESTS 0 ${ENABLED_BEHAVE_TESTS_QUADRANT_LENGTH} ENABLED_BEHAVE_TESTS_FIRST_QUADRANT)
list(SUBLIST ENABLED_BEHAVE_TESTS ${ENABLED_BEHAVE_TESTS_SECOND_QUADRANT_START} ${ENABLED_BEHAVE_TESTS_QUADRANT_LENGTH} ENABLED_BEHAVE_TESTS_SECOND_QUADRANT)
list(SUBLIST ENABLED_BEHAVE_TESTS ${ENABLED_BEHAVE_TESTS_THIRD_QUADRANT_START} ${ENABLED_BEHAVE_TESTS_QUADRANT_LENGTH} ENABLED_BEHAVE_TESTS_THIRD_QUADRANT)
list(SUBLIST ENABLED_BEHAVE_TESTS ${ENABLED_BEHAVE_TESTS_LAST_QUADRANT_START} -1 ENABLED_BEHAVE_TESTS_LAST_QUADRANT)

set(ENABLED_BEHAVE_TESTS ${ENABLED_BEHAVE_TESTS} PARENT_SCOPE)
set(ENABLED_BEHAVE_TESTS_FIRST_QUADRANT ${ENABLED_BEHAVE_TESTS_FIRST_QUADRANT} PARENT_SCOPE)
set(ENABLED_BEHAVE_TESTS_SECOND_QUADRANT ${ENABLED_BEHAVE_TESTS_SECOND_QUADRANT} PARENT_SCOPE)
set(ENABLED_BEHAVE_TESTS_THIRD_QUADRANT ${ENABLED_BEHAVE_TESTS_THIRD_QUADRANT} PARENT_SCOPE)
set(ENABLED_BEHAVE_TESTS_LAST_QUADRANT ${ENABLED_BEHAVE_TESTS_LAST_QUADRANT} PARENT_SCOPE)
set(ALL_BEHAVE_TESTS ${FEATURE_FILES} PARENT_SCOPE)
