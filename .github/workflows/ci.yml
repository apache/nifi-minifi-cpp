name: "MiNiFi-CPP CI"
on: [push, pull_request, workflow_dispatch]
jobs:
  ubuntu_22_04_clang_arm:
    name: "Ubuntu 22.04 clang aarch64"
    runs-on: ubuntu-22.04-arm
    timeout-minutes: 240
    steps:
      - id: checkout
        uses: actions/checkout@v4
      - name: list-changed-cpp-files
        id: list-changed-cpp-files
        run: |
          head_commit=${{github.sha}}
          if [[ -n "${{github.event.pull_request.base.sha}}" ]]; then
            base_commit=${{github.event.pull_request.base.sha}}
          else
            git fetch --depth=2 origin ${head_commit}
            base_commit=$(git log -n2 --format=format:%H ${head_commit} | tail -n1)
          fi
          echo "Collecting .cpp files from ${base_commit} to ${head_commit}"
          echo "files=$(git diff --name-only --diff-filter=ACMRT ${base_commit} ${head_commit} | grep '\.cpp$' | xargs)" >> $GITHUB_OUTPUT
      - name: clang-tidy
        run: |
          echo "${{steps.list-changed-cpp-files.outputs.files}}"
